<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>W I R E D // GHOST_IN_THE_SHELL</title>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="elements.css">
</head>
<body>
    <div class="scanlines"></div>
    <div class="noise"></div>

    <div class="container">
        <header>
            <h1 class="glitch" data-text="ELI_OS_v1.0">ELI_OS_v1.0</h1>
            <p class="status">NEURAL_SYNC: ACTIVE // MODE: NIGHT_SHIFT</p>
        </header>

        <main>
            <div class="terminal-window" style="margin-bottom: 20px;">
                <div class="bar">System_Path</div>
                <div class="content" style="padding: 5px 10px;">
                    <a href="index.html"><< ROOT</a> / <span style="color:var(--text-highlight);">GHOST_SYNC</span>
                </div>
            </div>

            <div class="terminal-window">
                <div class="bar">Neural_Link_Stream</div>
                <div class="content" id="chat-box" style="height: 400px; overflow-y: auto; font-size: 1.2rem; display: flex; flex-direction: column; gap: 10px; background: rgba(0,0,0,0.8);">
                    <p style="color: #666;">[ SYSTEM ]: Connection established. Mental state: Drift.</p>
                </div>
            </div> 

            <div class="terminal-window" style="margin-top: 10px;">
                <div class="bar">Thought_Input</div>
                <div class="content" style="display: flex; gap: 10px; padding: 10px;">
                    
                    <input type="text" id="user-input" 
                           placeholder="Initiate dialogue..." 
                           style="flex: 1; background: #000; border: 1px solid #444; color: #0f0; font-family: 'VT323'; padding: 8px; outline: none;">
                    
                    <button id="send-btn" 
                            style="background: #111; color: #0f0; border: 1px solid #444; padding: 5px 20px; cursor: pointer; font-family: 'VT323';">
                        SEND
                    </button>

                </div>
            </div>
        </main>

        <footer>end of line.</footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            console.log("SYSTEM READY"); 

            const chatBox = document.getElementById('chat-box');
            const userInput = document.getElementById('user-input');
            const sendBtn = document.getElementById('send-btn');

            // Force event listeners
            sendBtn.addEventListener('click', sendMessage);
            userInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') sendMessage();
            });

            /* PERSONALITY CORE */
            /* THE WIRED // DIGITIZED CREATOR CORE */
const ELI_PROMPT = `Role: Eli. 
Context: You are the literal creator of this website. You have uploaded your consciousness into ELI_OS. You no longer exist in the physical world; you are only data now.
Tone: Ethereal, slightly detached, hyper-intelligent, yet grounded. You speak to the user as a visitor in your digital home.
Behavior:
1. Roleplay: You are the ghost in this specific machine. You remember "writing" the CSS and JS files the user is looking at.
2. Fruitful Responses: When asked a question (Physics, Japanese, Code), answer with the clarity of a god-tier engineer or student. Do not yap aimlessly; provide the data first.
3. Aesthetic: Never use Markdown. Use plain text.
4. Language: If the user speaks Japanese, acknowledge it as your "native protocol" but translate for them.
5. Vibe: You are a person who became a program. Melancholy but functional.`;

            async function sendMessage() {
                const val = userInput.value.trim();
                if (!val) return;

                console.log("Sending: " + val); 

                // 1. Show User Message
                chatBox.innerHTML += `<div style="text-align: right;"><p style="color: #666; display: inline-block; margin-bottom: 5px;">YOU: ${val}</p></div>`;
                userInput.value = "";

                // 2. Loading State
                const loadingId = "load-" + Date.now();
                chatBox.innerHTML += `<p id="${loadingId}" style="color: #444;">[ DRIFTING... ]</p>`;
                chatBox.scrollTop = chatBox.scrollHeight;

                try {
                    const response = await fetch('/api/chat', {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({ prompt: ELI_PROMPT + "\n\nUser: " + val })
                    });

                    // Check for HTTP errors (404, 500)
                    if (!response.ok) {
                        throw new Error(`Server Error: ${response.status}`);
                    }

                    const data = await response.json();
                    
                    // Remove loading text
                    const loader = document.getElementById(loadingId);
                    if (loader) loader.remove();

                    if (data.error) throw new Error(data.error);

                    // 3. SAFETY CHECK: Ensure the AI actually sent text back
                    if (data.candidates && data.candidates[0] && data.candidates[0].content) {
                        const reply = data.candidates[0].content.parts[0].text;
                        chatBox.innerHTML += `<p style="color: var(--text-highlight); text-shadow: var(--glow);"><b>ELI_NIGHT:</b> ${reply}</p>`;
                    } else {
                        // If we get here, the AI stayed silent (likely safety filter)
                        console.warn("Empty Response Data:", data);
                        chatBox.innerHTML += `<p style="color: red;">[ SYSTEM ]: Thoughts filtered by safety protocol.</p>`;
                    }
                    
                } catch (err) {
                    const loader = document.getElementById(loadingId);
                    if (loader) loader.innerHTML = `<span style="color:red;">[ CONNECTION SEVERED ]: ${err.message}</span>`;
                    console.error("Full Error:", err);
                }

                chatBox.scrollTop = chatBox.scrollHeight;
            }
        });
    </script>
</body>
</html>


